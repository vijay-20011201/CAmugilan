<!-- ================= NAVBAR ================= -->
<nav class="fixed top-0 left-0 w-full bg-white shadow z-40">
  <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6">
    <div class="flex items-center justify-between h-14 sm:h-16 md:h-20">
<!-- Logo -->
<a href="index.html" class="flex items-center gap-2 sm:gap-3 shrink-0">
  <img src="assets/calogo.png" alt="Mugilan Poonkundran & Co Logo" class="w-16 h-16 sm:w-18 sm:h-18 md:w-20 md:h-20 object-contain">
  <div class="leading-tight">
    <h1 class="font-bold text-xs sm:text-sm md:text-lg truncate max-w-[140px] sm:max-w-none">Mugilan Poonkundran & Co</h1>
    <p class="text-[10px] sm:text-xs text-gray-500 hidden sm:block">Chartered Accountant</p>
  </div>
</a>

      <!-- Center Menu (Desktop) -->
      <div class="hidden lg:flex items-center gap-8 font-medium text-gray-700">
        <a href="index.html" class="hover:text-blue-700 transition">Home</a>
        <a href="./aboutus.html" class="hover:text-blue-700 transition">About</a>

          <!-- Services Dropdown (Two Columns Side by Side) -->
        <div class="relative group">
          <button class="flex items-center gap-1 hover:text-blue-700 transition py-4">
            Services
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <div class="absolute left-1/2 -translate-x-1/2 top-full pt-0 w-[550px] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
             <!-- Invisible bridge -->
            <div class="h-2"></div>
            
            <div class="bg-white rounded-xl shadow-2xl border border-gray-100 p-4 overflow-hidden">
              <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-blue-400"></div>
              
              <div class="grid grid-cols-2 gap-4">
                <!-- Left Column: Main Services -->
                <div>
                  <a href="./audit&assurance.html" class="flex items-center gap-3 px-3 py-2.5 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üìä</span> Audit & Assurance
                  </a>
                  <a href="./incometax.html" class="flex items-center gap-3 px-3 py-2.5 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üìë</span> Taxation Services
                  </a>
                  <a href="./gstregistration.html" class="flex items-center gap-3 px-3 py-2.5 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üßæ</span> GST Services
                  </a>
                  <a href="./DPIITRegistration.html" class="flex items-center gap-3 px-3 py-2.5 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üèõÔ∏è</span> DPIIT Registration
                  </a>
                </div>

                <!-- Right Column: Others -->
                <div class="border-l border-gray-200 pl-4">
                  <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 px-3">Others</p>
                  <a href="./esicregistration.html" class="flex items-center gap-2 px-3 py-2 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üìã</span> ESIC Registration & Filings
                  </a>
                  <a href="./pfreturnfilling.html" class="flex items-center gap-2 px-3 py-2 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üìù</span> PF Return Filing Services
                  </a>
                  <a href="./payrollprocessing.html" class="flex items-center gap-2 px-3 py-2 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üè¢</span> Payroll Processing
                  </a>
                  <a href="./cfoservice.html" class="flex items-center gap-2 px-3 py-2 hover:bg-blue-50 hover:text-blue-700 transition text-sm rounded-lg whitespace-nowrap">
                     <span>üìÑ</span> CFO Services
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <a href="./contact.html" class="hover:text-blue-700 transition">Contact</a>
      </div>

      <!-- Right CTA (Desktop) -->
      <div class="hidden lg:block">
        <button id="openConsultationModal" class="bg-[#1e3a8a] text-white px-4 md:px-5 py-2 md:py-2.5 rounded-full text-xs md:text-sm font-semibold hover:bg-blue-800 transition shadow-lg">
          Book Consultation
        </button>
      </div>

      <!-- Mobile Button -->
      <button 
        id="menuBtn" 
        onclick="document.getElementById('mobileMenu').classList.toggle('hidden')"
        class="lg:hidden text-xl sm:text-2xl p-1.5 sm:p-2 hover:bg-gray-100 rounded-lg transition">
        ‚ò∞
      </button>
    </div>
  </div>

  <!-- ================= MOBILE MENU ================= -->
  <div id="mobileMenu" class="hidden lg:hidden bg-white border-t max-h-[80vh] overflow-y-auto">
    <div class="px-3 sm:px-4 py-3 sm:py-4 space-y-1">
      <a class="block py-2.5 sm:py-3 px-2 hover:bg-gray-50 rounded-lg font-medium text-sm sm:text-base" href="index.html">Home</a>
      <a class="block py-2.5 sm:py-3 px-2 hover:bg-gray-50 rounded-lg font-medium text-sm sm:text-base" href="./aboutus.html">About</a>

     <!-- Mobile Services Dropdown -->
       <div>
        <button 
          id="mobileServiceBtn"
          class="w-full flex justify-between items-center py-2.5 sm:py-3 px-2 hover:bg-gray-50 rounded-lg font-medium text-sm sm:text-base">
          Services
          <span class="transition-transform duration-300">‚ñæ</span>
        </button>

        <div id="mobileServices" class="hidden pl-3 sm:pl-4 pb-2 space-y-2 text-xs sm:text-sm border-l-2 border-blue-600 ml-3 sm:ml-4 mt-2">
          <!-- Main Services -->
          <div class="space-y-1">
            <a href="./audit&assurance.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üìä</span> Audit & Assurance</a>
            <a href="./incometax.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üìë</span> Taxation Services</a>
            <a href="./gstregistration.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üßæ</span> GST Services</a>
            <a href="./DPIITRegistration.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üèõÔ∏è</span> DPIIT Registration</a>
          </div>

          <!-- Others -->
          <div class="border-t border-gray-200 pt-2">
            <p class="text-[10px] sm:text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Others</p>
            <a href="./esicregistration.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üìã</span> ESIC Registration & Filings</a>
            <a href="./pfreturnfilling.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üìù</span> PF Return Filing Services</a>
            <a href="./payrollprocessing.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üè¢</span> Payroll Processing</a>
            <a href="./cfoservice.html" class="flex items-center gap-2 hover:text-blue-700 transition py-1"><span>üìÑ</span> CFO Services</a>
          </div>
        </div>
      </div>

      <a class="block py-2.5 sm:py-3 px-2 hover:bg-gray-50 rounded-lg font-medium text-sm sm:text-base" href="./contact.html">Contact</a>

      <div class="pt-3 sm:pt-4">
        <button onclick="openConsultationModal()" class="block w-full bg-blue-700 text-white text-center py-2.5 sm:py-3 rounded-xl font-semibold text-sm sm:text-base hover:bg-blue-800 transition">
          Book Consultation
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- ================= FREE CONSULTATION MODAL (POPUP) ================= -->
<div id="consultationModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center p-4 transition-opacity duration-300">
  <div class="bg-white rounded-2xl shadow-xl border border-gray-100 max-w-lg w-full max-h-[90vh] overflow-y-auto relative scale-95 transition-transform duration-300">
    
    <!-- Close Button -->
    <button id="closeModalBtn" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-3xl font-light z-50 transition-colors">&times;</button>

    <!-- Header with Gradient Accent -->
    <div class="relative bg-gradient-to-r from-blue-600 to-blue-400 p-6 rounded-t-2xl">
      <h2 class="font-serif text-2xl sm:text-3xl font-bold text-white mb-1">
        Book a Free Consultation
      </h2>
      <p class="text-blue-100 text-sm sm:text-base">
        Our experts will get in touch within 24 hours.
      </p>
    </div>

    <div class="p-6 sm:p-8">
      <form id="appointmentForm" class="space-y-5">

        <!-- Name - With Icon -->
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1.5">
            Full Name *
          </label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">üë§</span>
            <input
              type="text"
              name="name"
              required
              class="w-full pl-10 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-sm
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"
              placeholder="Enter your full name">
          </div>
        </div>

        <!-- Email - With Icon -->
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1.5">
            Email Address *
          </label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">‚úâÔ∏è</span>
            <input
              type="email"
              name="email"
              required
              class="w-full pl-10 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-sm
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"
              placeholder="you@example.com">
          </div>
        </div>

        <!-- Phone - With Icon -->
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1.5">
            Phone Number *
          </label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">üìû</span>
            <input
              type="tel"
              name="phone"
              required
              class="w-full pl-10 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-sm
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"
              placeholder="+91 XXXXX XXXXX">
          </div>
        </div>

        <!-- Services - Custom Dropdown -->
        <div class="relative">
          <label class="block text-sm font-medium text-gray-700 mb-1.5">
            Select Service *
          </label>
          
          <!-- Hidden input for form submission -->
          <input type="hidden" name="service" id="modalServiceInput" required>
          
          <!-- Custom Dropdown Trigger -->
          <div id="modalDropdownTrigger" 
               class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3
                      cursor-pointer flex items-center justify-between
                      hover:border-blue-400 transition-all text-sm">
            <span id="modalSelectedText" class="text-gray-500">-- Select a Service --</span>
            <svg id="modalDropdownArrow" class="h-4 w-4 text-gray-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
          
          <!-- Custom Dropdown Options -->
          <div id="modalDropdownOptions" 
               class="hidden absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl z-[100] overflow-y-scroll"
               style="max-height: 200px;">
            <div class="py-1">
              <!-- Main Services -->
              <div data-value="Audit & Assurance" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">Audit & Assurance</div>
              <div data-value="Taxation Services" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">Taxation Services</div>
              <div data-value="GST Services" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">GST Services</div>
              <div data-value="DPIIT Registration" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">DPIIT Registration</div>
              
              <!-- Others -->
              <div data-value="ESIC Registration & Filings" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">ESIC Registration & Filings</div>
              <div data-value="PF Return Filing Services" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">PF Return Filing Services</div>
              <div data-value="Payroll Processing" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">Payroll Processing</div>
              <div data-value="CFO Services" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">CFO Services</div>
              
              <!-- Other Services -->
              <div data-value="Others" class="modal-dropdown-option px-4 py-2.5 text-sm hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors">Others</div>
            </div>
          </div>
        </div>

        <!-- Submit -->
        <button
          id="submitBtn"
          type="submit"
          class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg
                 hover:bg-blue-700 transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
          <span id="submitText">Submit Request</span>
        </button>

        <!-- Status -->
        <p id="statusMsg" class="text-center text-sm font-medium h-5 mt-3"></p>
      </form>
    </div>
  </div>
</div>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script>
  (function(){
    emailjs.init("YOUR_PUBLIC_KEY"); // Replace with your EmailJS Public Key
  })();

  // Modal Functions
  function openConsultationModal() {
    const modal = document.getElementById('consultationModal');
    modal.classList.remove('hidden');
    setTimeout(() => {
      modal.querySelector('div.relative.scale-95').classList.remove('scale-95');
      modal.classList.add('opacity-100');
    }, 10);
    document.body.style.overflow = 'hidden';
  }

  function closeConsultationModal() {
    const modal = document.getElementById('consultationModal');
    modal.classList.add('hidden');
    modal.querySelector('div.relative').classList.add('scale-95');
    document.body.style.overflow = 'auto';
  }

  // Event Listeners
  document.getElementById('openConsultationModal')?.addEventListener('click', openConsultationModal);

  document.getElementById('closeModalBtn')?.addEventListener('click', closeConsultationModal);

  // Close modal on outside click
  document.getElementById('consultationModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeConsultationModal();
    }
  });

  // Close modal on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeConsultationModal();
    }
  });

  const form = document.getElementById("appointmentForm");
  const statusMsg = document.getElementById("statusMsg");
  const submitBtn = document.getElementById("submitBtn");
  const submitText = document.getElementById("submitText");

  if (form) {
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      statusMsg.textContent = "Sending your request...";
      statusMsg.className = "text-center text-sm font-medium h-5 mt-3 text-blue-600";
      submitBtn.disabled = true;
      submitText.textContent = "Sending...";

      emailjs.sendForm(
        "YOUR_SERVICE_ID",      // Replace with your EmailJS Service ID
        "YOUR_TEMPLATE_ID",     // Replace with your EmailJS Template ID
        this
      ).then(
        function(response) {
          console.log('SUCCESS!', response.status, response.text);
          statusMsg.textContent = "‚úì Success! We'll contact you soon.";
          statusMsg.className = "text-center text-sm font-medium h-5 mt-3 text-green-600";
          
          form.reset();
          
          const selectedText = document.getElementById('modalSelectedText');
          const serviceInput = document.getElementById('modalServiceInput');
          if (selectedText) {
            selectedText.textContent = '-- Select a Service --';
            selectedText.className = 'text-gray-500';
          }
          if (serviceInput) serviceInput.value = '';
          
          submitBtn.disabled = false;
          submitText.textContent = "Submit Request";
          
          setTimeout(closeConsultationModal, 2000);
        },
        function(error) {
          console.log('FAILED...', error);
          statusMsg.textContent = "‚úó Error: Please try again later.";
          statusMsg.className = "text-center text-sm font-medium h-5 mt-3 text-red-600";
          submitBtn.disabled = false;
          submitText.textContent = "Submit Request";
        }
      );
    });
  }

  // ============================================
  // MODAL CUSTOM DROPDOWN HANDLERS
  // ============================================
  const modalDropdownTrigger = document.getElementById('modalDropdownTrigger');
  const modalDropdownOptions = document.getElementById('modalDropdownOptions');
  const modalDropdownArrow = document.getElementById('modalDropdownArrow');
  const modalSelectedText = document.getElementById('modalSelectedText');
  const modalServiceInput = document.getElementById('modalServiceInput');

  // Toggle dropdown
  if (modalDropdownTrigger) {
    modalDropdownTrigger.addEventListener('click', function(e) {
      e.stopPropagation();
      modalDropdownOptions.classList.toggle('hidden');
      modalDropdownArrow.classList.toggle('rotate-180');
    });
  }

  // Handle option selection
  if (modalDropdownOptions) {
    modalDropdownOptions.querySelectorAll('.modal-dropdown-option').forEach(option => {
      option.addEventListener('click', function() {
        const value = this.getAttribute('data-value');
        modalSelectedText.textContent = value;
        modalSelectedText.className = 'text-gray-700';
        modalServiceInput.value = value;
        modalDropdownOptions.classList.add('hidden');
        modalDropdownArrow.classList.remove('rotate-180');
      });
    });
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (modalDropdownOptions && !modalDropdownOptions.classList.contains('hidden')) {
      if (!modalDropdownTrigger?.contains(e.target) && !modalDropdownOptions?.contains(e.target)) {
        modalDropdownOptions.classList.add('hidden');
        modalDropdownArrow?.classList.remove('rotate-180');
      }
    }
  });

  // Mobile menu toggle
  const mobileServiceBtn = document.getElementById('mobileServiceBtn');
  const mobileServices = document.getElementById('mobileServices');
  
  if (mobileServiceBtn) {
    mobileServiceBtn.addEventListener('click', function() {
      mobileServices.classList.toggle('hidden');
      const arrow = this.querySelector('span');
      if (arrow) {
        arrow.style.transform = mobileServices.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
      }
    });
  }
</script>